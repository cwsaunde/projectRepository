<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<head>
    <meta charset="utf-8" />
    <!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://mysqljs.com/mysql.js" type="text/javascript"></script>

    <!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
    <script type="text/javascript">
        var gUser = localStorage.getItem('key');
        var sqlStmt2 = "Select * from bankAccounts";
        var whereClause2 = " JOIN Users ON Users.userID = bankAccounts.userID  WHERE Users.userID = " + "'" + String(gUser) + "'";
        sqlStmt2 = sqlStmt2 + whereClause2;
        window.onload = function () {
            MySql.Execute(
                "107.180.1.16",
                "group7-2",
                "!!Group7",
                "group7-2",
                sqlStmt2,
                function (data) {
                    var info = data['Result'][0];
                    console.log(info); 
                    var account = info['accountNum'];
                    var amount = info['amount'];
                    var accountType = info['accountType'];
                    var phone = info['phone'];
                    var location = info['location'];
                    var User = info['userID'];
                    document.getElementById("Balance").innerHTML = "Balance: " + amount;
                    document.getElementById("Account").innerHTML = "Account: " + account;
                    document.getElementById("Location").innerHTML = "Location: " + location;
                    document.getElementById("Phone").innerHTML = "Phone: " + phone;
                    document.getElementById("User").innerHTML = "User:  " + User;
                }
            );

        }

        function change(value) {
            if (value == "ePhone") {
                //console.log('ephone');
                    function textValue() {
                    var edit = prompt("Phone Number", "Enter New Phone Number");
                        return edit;
                }
                var Phone = textValue();    
                let nPhone = Phone;
                var sqlStmt = "UPDATE Users SET phone = " + "'" + nPhone + "'" + " WHERE userID = " + "'" + gUser + "'";
                if (nPhone != null) {
                    MySql.Execute(
                        "107.180.1.16",
                        "group7-2",
                        "!!Group7",
                        "group7-2",
                        sqlStmt,
                        function (data) {
                            alert("Phone is Updated");
                            location.reload();
                        }
                    );
                }
            }
            else if (value == 'eLocation') {
                //console.log('Locaiton');
                function textValue() {
                    var edit = prompt("Change Location", "Enter New Location");
                    return edit;
                }
                var Location = textValue();    
                let nLocation = Location;
                var sqlStmt = "UPDATE Users SET location = " + "'" + nLocation + "'" + " WHERE userID = " + "'" + gUser + "'";
                if (nLocation != null) {
                    MySql.Execute(
                        "107.180.1.16",
                        "group7-2",
                        "!!Group7",
                        "group7-2",
                        sqlStmt,
                        function (data) {
                            alert("Location is Updated");
                            location.reload();
                        }
                    );
                }

            }
            else {
                //console.log('user')
                function textValue() {
                    var edit = prompt("Change User ID", "Enter New User ID");
                    return edit;
                }
                var ID = textValue();    
                let nID = ID;
                var sqlStmt = "UPDATE Users SET userID = " + "'" + nID + "'" + " WHERE userID = " + "'" + gUser + "'";
                if (nID != null) {
                    MySql.Execute(
                        "107.180.1.16",
                        "group7-2",
                        "!!Group7",
                        "group7-2",
                        sqlStmt,
                        function (data) {
                            alert("UserID is Updated");
                            location.reload();
                        }
                    );
                }
            }

            
        }

        function deposit() {
            var amount = document.getElementById("userAmt").value;
            var currentAmount = document.getElementById("Balance").innerHTML;

            currentAmount = currentAmount.slice(9, currentAmount.length);

            var newAmount = parseInt(amount) + parseInt(currentAmount);

            

            sqlStmt = "UPDATE bankAccounts SET amount = " + newAmount + " WHERE userID = " + "'" + gUser + "'";

            MySql.Execute(
                "107.180.1.16",
                "group7-2",
                "!!Group7",
                "group7-2",
                sqlStmt,
                function (data) {
                    alert("The amount has been added");
                    console.log(data);
                    location.reload();
                }
            );

            

        }

        function withdraw() {
            var amount = document.getElementById("userAmt").value;
            var currentAmount = document.getElementById("Balance").innerHTML;

            currentAmount = currentAmount.slice(9, currentAmount.length);

            var newAmount = parseInt(currentAmount) - parseInt(amount);

            console.log('New Amount: ' + newAmount);

            sqlStmt = "UPDATE bankAccounts SET amount = " + newAmount + " WHERE userID = " + "'" + gUser + "'";

            console.log(sqlStmt);

            MySql.Execute(
                "107.180.1.16",
                "group7-2",
                "!!Group7",
                "group7-2",
                sqlStmt,
                function (data) {
                    alert("The amount has been withdrawn!");
                    console.log(data);
                    location.reload();
                }
            );

            

        }
        //localStorage.removeItem('key');
    </script>

    <title>Homepage</title>
    <style>
        div.topPage {
            background-color: black;
            font: 18px;
            color: white;
            overflow: hidden;
        }
        div.centerPage{
            font-weight: bold;
            padding-bottom: 18%;
        }

        div.bottomPage {
            background-color: black;
            font: 12px;
            color: white;
            padding-top: auto;
            /* margin-bottom: auto; */
            overflow: hidden;
        }

            li {
                display: inline-block;
                width: 200px;
                /* padding-left: 50%; */
            }

        table, th, td{
            border: 1px solid black;
        }

        #deathStar {
            /*overflow:hidden;*/
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        #account {
            float: left;
            font-size: 24px;
            margin-left: 10%;
        }

        #signOut {
            float: right;
            font-size: 24px;
            margin-right: 10%;
        }
    </style>
</head>
<body>
    <div class="topPage">
        <img id="deathStar" src="deathstar.png" height="170" width="170" />
        <p id="Account"></p>
        <p id="signOut"><a href="index.html">Sign Out</a></p>
        <p id="Phone"></p>
        <p id="Location"></p>
        <p id="User"></p>
        <!-- <p id="signOut"><a href="index.html">Sign Out</a></p> -->
    </div>
    <div class="centerPage">
        <p id="Balance"></p>
        <select id="Edit" onchange="change(value)">Settings
            <option value="ePhone">Edit Phone Number</option>
            <option value="eLocation" >Edit Location</option>
            <option value="eUser" >Edit User Name</option>
        </select>
        <button onclick="Save">Save</button>

        <br /><hr /><br />

        <div>
            <input type="number" name="amount" min="0" step="100" id="userAmt" />
            <button onclick="deposit()">Deposit</button>
            <button onclick="withdraw()">Withdraw</button>
        </div>

        <br /><hr /><br />

        <h3>Transaction History</h3>
        <table class="transactionLog">
            <tr>
                <th>Date</th><th>Location</th><th>Amount</th><th>Total</th>
            </tr>
            <tr>
                <td>ExampleDate</td><td>LocationExample</td><td>ExampleAmount</td><td>ExampleTotal</td>
            </tr>
        </table>
    </div>
    <div class="bottomPage">
        <div class="helpLinks">
            <ul>
                <li>Contact Us</li>
                <li>Support</li>
                <li>Terms of Service</li>
            </ul>
        </div>
    </div>

</body>
</html>
